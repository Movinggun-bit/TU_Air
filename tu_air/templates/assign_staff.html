{% extends "base.html" %}
{% block title %}직원 배정 - 관리자{% endblock %}

{% block content %}
<div class="register-container" style="max-width: 900px;"> 
    <h1 class="register-title">직원 배정 (Staff Assignment)</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="flash-message {{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form class="register-form" method="POST" action="{{ url_for('admin.assign_staff') }}">
        <div class="admin-form-row">
            <label class="label-with-button">
                기장 *
                <button class="btn-select-aircraft-small" onclick="redirectToStaffSelection('captain')">기장 선택</button>
            </label>
            <input type="text" class="form-input-register" name="captain" id="captain" readonly required>
        </div>

        <div class="admin-form-row">
            <label class="label-with-button">
                부기장
                <button class="btn-select-aircraft-small" onclick="redirectToStaffSelection('co_pilot')">부기장 선택</button>
            </label>
            <input type="text" class="form-input-register" name="co_pilot" id="co_pilot" readonly>
        </div>

        <div class="admin-form-row">
            <label class="label-with-button">
                승무원
                <button class="btn-select-aircraft-small" onclick="redirectToStaffSelection('crew')">승무원 선택</button>
            </label>
            <input type="text" class="form-input-register" name="crew" id="crew" readonly>
        </div>

        <button type="submit" class="btn-register-submit">배정 완료</button>
    </form>
</div>

{% include '_airport_modal.html' %}

{% endblock %}

{% block scripts %}
<script>
    function redirectToStaffSelection(role) {
        // 역할에 따라 직원 선택 화면으로 이동
        const url = `/admin/staff/selection?role=${encodeURIComponent(role)}`;
        window.location.href = url;
    }

    // 직원 배정 버튼 클릭 시 필수 입력 필드 확인
    document.querySelector('form').addEventListener('submit', function(event) {
        const captain = document.getElementById('captain').value;
        const coPilot = document.getElementById('co_pilot').value;
        const crew = document.getElementById('crew').value;

        if (!captain || !coPilot || !crew) {
            event.preventDefault();
            alert('모든 직원 배정 정보를 입력해주세요.');
        }
    });

    // 버튼 클릭 시 폼 제출 방지
    document.querySelectorAll('.btn-select-aircraft-small').forEach(button => {
        button.addEventListener('click', function(event) {
            event.preventDefault();
        });
    });
</script>
{% endblock %}