{% extends 'base.html' %}
{% block title %}직원 관리 - TU Air (Admin){% endblock %}

{% block head_style %}
{# 스케줄러, 엔지니어가 사용하던 CSS를 그대로 재사용합니다 #}
<link rel="stylesheet" href="{{ url_for('main.static', filename='css/modules/15_page_admin.css') }}?v=2">
<link rel="stylesheet" href="{{ url_for('main.static', filename='css/modules/16_page_flight_management.css') }}?v=3">
{% endblock %}

{% block content %}
<div class="admin-container">
    <h1 class="admin-title">직원 관리 (HR)</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    {# (오류는 'error', 성공은 'success' 클래스로 표시) #}
    <div class="flash-message {{ 'error' if category == 'error' else 'success' }}"
         style="background-color: {{ '#fff0f0' if category == 'error' else '#e6f7ff' }}; border-color: {{ '#D90429' if category == 'error' else '#004a99' }}; color: {{ '#D90429' if category == 'error' else '#004a99' }};">
        {{ message }}
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}

    <div class="admin-filter-box" style="border-color: #28a745; margin-top: 20px;">
        <h3 style="margin-top: 0; font-size: 20px;">새 직원 등록</h3>
        <form method="POST" action="{{ url_for('admin.hr_dashboard') }}" class="admin-filter-form">
            <input type="hidden" name="action" value="create">
            <div class="filter-inputs-wrapper">
                <div class="filter-group" style="flex: 1.5;">
                    <label for="staff_id_create">직원 ID *</label>
                    <input type="text" id="staff_id_create" name="staff_id" class="form-input-register" placeholder="예: HR006 (회원 ID와 중복 불가)" required>
                </div>
                <div class="filter-group" style="flex: 1.5;">
                    <label for="name_create">이름 *</label>
                    <input type="text" id="name_create" name="name" class="form-input-register" placeholder="예: 홍길동" required>
                </div>
                <div class="filter-group" style="flex: 1.5;">
                    <label for="passwd_create">임시 비밀번호 *</label>
                    <input type="password" id="passwd_create" name="passwd" class="form-input-register" required>
                </div>
                <div class="filter-group">
                    <label for="role_create">역할 *</label>
                    <select id="role_create" name="role" class="form-control" required>
                        <option value="" disabled selected>역할 선택</option>
                        {% for role in staff_roles %}
                        <option value="{{ role }}">{{ role }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="filter-group">
                    <label for="dept_create">부서 *</label>
                    <input type="text" id="dept_create" name="department" class="form-input-register" placeholder="예: Human Resources" required>
                </div>
            </div>
            <div class="filter-actions">
                <button type="submit" class="btn-primary" style="background-color: #28a745; border-color: #28a745;">직원 등록</button>
            </div>
        </form>
    </div>

    <div class="admin-filter-box" style="margin-top: 30px;">
        <h3 style="margin-top: 0; font-size: 20px;">직원 목록 조회</h3>
        <form method="GET" action="{{ url_for('admin.hr_dashboard') }}" class="admin-filter-form">
            <div class="filter-inputs-wrapper">
                <div class="filter-group">
                    <label for="staff_id_filter">직원 ID</label>
                    <input type="text" id="staff_id_filter" name="staff_id" value="{{ search_filters.get('staff_id', '') }}">
                </div>
                <div class="filter-group">
                    <label for="name_filter">이름</label>
                    <input type="text" id="name_filter" name="name" value="{{ search_filters.get('name', '') }}">
                </div>
                <div class="filter-group">
                    <label for="role_filter">역할</label>
                    <select id="role_filter" name="role" class="form-control">
                        <option value="">모든 역할</option>
                        {% for role in staff_roles %}
                        <option value="{{ role }}" {% if search_filters.get('role') == role %}selected{% endif %}>{{ role }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="filter-group">
                    <label for="dept_filter">부서</label>
                    <input type="text" id="dept_filter" name="department" value="{{ search_filters.get('department', '') }}">
                </div>
            </div>
            <div class="filter-actions">
                <button type="submit" class="btn-primary">검색</button>
                <a href="{{ url_for('admin.hr_dashboard') }}" class="btn-secondary">초기화</a>
            </div>
        </form>
    </div>

    <div class="admin-content-box">
        <div class="admin-table-container">
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>직원 ID</th>
                        <th>이름</th>
                        <th>역할</th>
                        <th>부서</th>
                        <th>관리</th>
                    </tr>
                </thead>
                <tbody>
                    {% if all_staff %}
                    {% for staff in all_staff %}
                    <tr>
                        <td>{{ staff.Staff_ID }}</td>
                        <td>{{ staff.Name }}</td>
                        <td>{{ staff.Role }}</td>
                        <td>{{ staff.Department }}</td>
                        <td>
                            {# 삭제 버튼은 작은 form으로 감싸서 POST 요청을 보냅니다 #}
                            <form method="POST" action="{{ url_for('admin.hr_dashboard') }}"
                                  onsubmit="return confirm('정말로 \'{{ staff.Name }}\' ({{ staff.Staff_ID }}) 님을 삭제하시겠습니까?');"
                                  style="margin: 0;">
                                <input type="hidden" name="action" value="delete">
                                <input type="hidden" name="staff_id_to_delete" value="{{ staff.Staff_ID }}">

                                {# 본인 계정은 삭제 버튼 비활성화 #}
                                <button type="submit" class="btn-action btn-cancel-flight"
                                        {% if staff.Staff_ID == g.user.Staff_ID %}disabled{% endif %}>
                                    삭제
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                    {% else %}
                    <tr>
                        <td colspan="5" class="no-data">
                            {% if search_filters.staff_id or search_filters.name or search_filters.role or search_filters.department %}
                            검색 조건에 맞는 직원이 없습니다.
                            {% else %}
                            등록된 직원이 없습니다.
                            {% endif %}
                        </td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{# 이 페이지는 별도 JS가 필요 없습니다 (삭제 확인은 onsubmit으로 처리) #}
{% endblock %}